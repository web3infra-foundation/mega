import { useEffect, useState } from 'react'
import Head from 'next/head'
import Image from 'next/image'
// import { ExclamationTriangleIcon, ShieldCheckIcon, ClockIcon, UserIcon } from '@heroicons/react/24/outline'
import { useRouter } from 'next/router'

import { AppLayout } from '@/components/Layout/AppLayout'
import AuthAppProviders from '@/components/Providers/AuthAppProviders'
import CveGraph from '@/components/Rust/Cve-graph/Cve-graph'

// CVE 详情接口类型定义
interface CVEDetail {
  id: string
  subtitle: string
  reported: string
  issued: string
  package: string
  ttype: string
  keywords: string
  aliases: string
  reference: string
  patched: string
  unaffected: string
  description: string
  url: string
}

interface DepTriggerResult {
  crate_version: string
  dep: string
  trigger: string
  reason: string
}

export default function CVEInfoPage() {
  const router = useRouter()
  const { cveId } = router.query

  // 状态管理
  const [cveData, setCveData] = useState<CVEDetail | null>(null)
  const [loading, setLoading] = useState(true)
  const [error, setError] = useState<string | null>(null)
  const [activeTab, setActiveTab] = useState<'details' | 'graph' | 'advisories'>('details')

  interface CveAnalyzeRes {
    crate_version: string
    dept_crate_version: string[]
  }
  const [graphData, setGraphData] = useState<CveAnalyzeRes[] | null>(null)
  const [graphLoading, setGraphLoading] = useState(false)
  const [graphError, setGraphError] = useState<string | null>(null)
  const [advisories, setAdvisories] = useState<DepTriggerResult[] | null>(null)
  const [advisoriesLoading, setAdvisoriesLoading] = useState(false)
  const [advisoriesError, setAdvisoriesError] = useState<string | null>(null)

  // 从 API 获取 CVE 详情数据
  useEffect(() => {
    const fetchCVEDetails = async () => {
      if (!cveId) return

      try {
        setLoading(true)
        setError(null)

        const apiBaseUrl = process.env.NEXT_PUBLIC_CRATES_PRO_URL
        const response = await fetch(`${apiBaseUrl}/api/cve/details/${cveId}`)

        if (!response.ok) {
          throw new Error('Failed to fetch CVE details')
        }

        const data: CVEDetail[] = await response.json()

        if (data && data.length > 0) {
          setCveData(data[0]) // 取第一个结果
        } else {
          throw new Error('No CVE data found')
        }
      } catch (err) {
        setError('Failed to load CVE details')

        // 如果 API 失败，使用默认数据
        setCveData({
          id: cveId as string,
          subtitle: 'CVE 详情加载失败',
          reported: 'Unknown',
          issued: 'Unknown',
          package: 'Unknown',
          ttype: 'Unknown',
          keywords: '',
          aliases: '',
          reference: '',
          patched: 'Unknown',
          unaffected: '',
          description: '无法加载 CVE 详情信息',
          url: ''
        })
      } finally {
        setLoading(false)
      }
    }

    fetchCVEDetails()
  }, [cveId])

  // 当切换到 Graph 标签时获取图数据
  useEffect(() => {
    const fetchGraph = async () => {
      if (activeTab !== 'graph' || !cveId) return
      try {
        setGraphLoading(true)
        setGraphError(null)

        const apiBaseUrl = process.env.NEXT_PUBLIC_CRATES_PRO_URL

        const res = await fetch(`${apiBaseUrl}/api/crates/${cveId}/cvegraph`)

        if (!res.ok) throw new Error('Failed to fetch CVE graph')

        const json = (await res.json()) as CveAnalyzeRes[]

        setGraphData(json)
      } catch (err) {
        setGraphError('加载失败，已使用演示数据')
        // 使用演示数据
        setGraphData([
          {
            crate_version: `${cveId}-1.0.0`,
            dept_crate_version: ['bytes@1.5.0', 'tokio-util@0.7.11', 'pin-project-lite@0.2.14']
          },
          { crate_version: `${cveId}-1.1.0`, dept_crate_version: ['mio@0.8.11', 'parking_lot@0.12.3'] },
          { crate_version: `${cveId}-0.9.0`, dept_crate_version: ['futures-core@0.3.30'] }
        ])
      } finally {
        setGraphLoading(false)
      }
    }

    fetchGraph()
  }, [activeTab, cveId])

  useEffect(() => {
    const fetchAdvisories = async () => {
      if (activeTab !== 'advisories' || !cveId) return

      try {
        setAdvisoriesLoading(true)
        setAdvisoriesError(null)

        const apiBaseUrl = process.env.NEXT_PUBLIC_CRATES_PRO_URL
        const res = await fetch(`${apiBaseUrl}/api/crates/${cveId}/cveragres`)

        if (!res.ok) {
          throw new Error('Failed to fetch advisories')
        }

        const json = (await res.json()) as DepTriggerResult[]
        
        setAdvisories(json)
      } catch (err) {
        setAdvisoriesError('建议数据加载失败')
        setAdvisories(null)
      } finally {
        setAdvisoriesLoading(false)
      }
    }

    fetchAdvisories()
  }, [activeTab, cveId])

  // 生成标签信息
  const getCveTag = (cve: CVEDetail | null) => {
    if (!cve) return { text: '未知', color: 'gray' }

    // 根据 ttype 生成标签
    if (cve.ttype.includes('Unmaintained')) {
      return { text: '项目已停止维护', color: 'red' }
    } else if (cve.ttype.includes('INFO')) {
      return { text: '信息类', color: 'blue' }
    } else if (cve.ttype.includes('WARN')) {
      return { text: '警告', color: 'yellow' }
    } else if (cve.ttype.includes('CRITICAL')) {
      return { text: '严重', color: 'red' }
    } else if (cve.ttype.includes('HIGH')) {
      return { text: '高危', color: 'red' }
    } else if (cve.ttype.includes('MEDIUM')) {
      return { text: '中危', color: 'yellow' }
    } else if (cve.ttype.includes('LOW')) {
      return { text: '低危', color: 'green' }
    }

    return { text: '安全漏洞', color: 'red' }
  }

  // 生成参考资料列表
  const getReferences = (cve: CVEDetail | null) => {
    if (!cve) return []

    const references = []

    if (cve.reference) {
      references.push({ title: 'Reference', url: cve.reference })
    }

    if (cve.url) {
      references.push({ title: 'RustSec Advisory', url: cve.url })
    }

    return references
  }

  if (loading) {
    return (
      <div className='flex min-h-screen items-center justify-center'>
        <div className='text-gray-500'>加载中...</div>
      </div>
    )
  }

  if (error && !cveData) {
    return (
      <div className='flex min-h-screen items-center justify-center'>
        <div className='text-red-500'>错误: {error}</div>
      </div>
    )
  }

  if (!cveData) {
    return (
      <div className='flex min-h-screen items-center justify-center'>
        <div className='text-gray-500'>未找到 CVE 信息</div>
      </div>
    )
  }

  const cveTag = getCveTag(cveData)
  const references = getReferences(cveData)

  //   const tabs = [
  //     { id: 'overview', name: '概览', icon: ExclamationTriangleIcon },
  //     { id: 'details', name: '详细信息', icon: ShieldCheckIcon },
  //     { id: 'timeline', name: '时间线', icon: ClockIcon },
  //     { id: 'references', name: '参考资料', icon: UserIcon }
  //   ]

  return (
    <>
      <Head>
        <title>{cveData.id} - CVE Information</title>
      </Head>
      <div className='h-screen overflow-auto'>
        {/* 顶部 CVE ID 和标签区域 */}
        <div className='mx-auto max-w-6xl px-4 py-8 sm:px-6 lg:px-8'>
          <div className='flex items-center justify-between'>
            <div className='flex items-center space-x-4'>
              {/* <Link
                href={{
                  pathname: `/${router.query.org || 'org'}/rust/rust-ecosystem/ecosystem-cve/cve-info/cve-graph`,
                  query: { cveId: cveData.id }
                }}
              > */}
              <h1 className='text-3xl font-bold text-gray-900'>{cveData.id}</h1>
              {/* </Link> */}
              <span
                style={{
                  display: 'inline-flex',
                  padding: '2px 6px',
                  justifyContent: 'center',
                  alignItems: 'center',
                  gap: '6px',
                  borderRadius: '3px',
                  background: '#0047f112',
                  color: '#002bb7c4',
                  fontFamily: 'HarmonyOS Sans SC',
                  fontSize: '12px',
                  fontStyle: 'normal',
                  fontWeight: 400,
                  lineHeight: '16px',
                  letterSpacing: '0.04px'
                }}
              >
                {cveTag.text}
              </span>
            </div>
            <button className='flex items-center rounded-lg bg-blue-600 px-4 py-2 text-white transition-colors hover:bg-blue-700'>
              <Image
                src='/rust/rust-ecosystem/ecosystem-cve/cve-info/Frame.png'
                alt='Frame'
                width={4}
                height={4}
                className='mr-2 h-4 w-4'
              />
              View Json
            </button>
          </div>

          {/* 分割线 */}
          <div className='-mx-52 mt-6 border-b border-gray-200'></div>
        </div>

        {/* 主要内容区域 */}
        <div className='mx-auto max-w-6xl px-4 pb-16 sm:px-6 lg:px-8'>
          <div className='mb-6 flex items-center gap-2'>
            <button
              onClick={() => setActiveTab('details')}
              className={`${activeTab === 'details' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700'} rounded border border-gray-200 px-4 py-2 hover:border-blue-400`}
            >
              CVE Details
            </button>
            <button
              onClick={() => setActiveTab('graph')}
              className={`${activeTab === 'graph' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700'} rounded border border-gray-200 px-4 py-2 hover:border-blue-400`}
            >
              CVE Graph
            </button>
            <button
              onClick={() => setActiveTab('advisories')}
              className={`${activeTab === 'advisories' ? 'bg-blue-600 text-white' : 'bg-white text-gray-700'} rounded border border-gray-200 px-4 py-2 hover:border-blue-400`}
            >
              CVE Advisories
            </button>
          </div>

          {/* 详情内容 */}
          {activeTab === 'details' && (
            <div className='space-y-6'>
              {/* CNA 卡片 */}
              <div className='rounded-lg border border-gray-200 bg-white p-6 shadow-sm'>
                <h3
                  className='mb-4'
                  style={{
                    alignSelf: 'stretch',
                    color: '#3a5bc7',
                    fontFamily: 'HarmonyOS Sans SC',
                    fontSize: '32px',
                    fontStyle: 'normal',
                    fontWeight: 500,
                    lineHeight: '40px',
                    letterSpacing: '-0.16px'
                  }}
                >
                  CNA : MITRE Corporation
                </h3>
                <div
                  style={{
                    width: '100%',
                    height: '1px',
                    background: 'rgba(0, 0, 0, 0.08)',
                    marginBottom: '16px'
                  }}
                />
                <div className='space-y-4'>
                  <div>
                    <h4
                      className='mb-2'
                      style={{
                        alignSelf: 'stretch',
                        color: '#1c2024',
                        fontFamily: 'HarmonyOS Sans SC',
                        fontSize: '24px',
                        fontStyle: 'normal',
                        fontWeight: 500,
                        lineHeight: 'normal',
                        letterSpacing: '-0.16px'
                      }}
                    >
                      Description
                    </h4>
                    <div className='mb-4'>
                      <p className='mb-1 text-sm text-gray-600'>
                        <span className='font-medium'>Package:</span> {cveData.package}
                      </p>
                      <p className='text-sm text-gray-600'>
                        <span className='font-medium'>Type:</span> {cveData.ttype}
                      </p>
                    </div>
                    <p
                      className='mb-6'
                      style={{
                        alignSelf: 'stretch',
                        color: '#80838d',
                        fontFamily: 'HarmonyOS Sans SC',
                        fontSize: '16px',
                        fontStyle: 'normal',
                        fontWeight: 400,
                        lineHeight: 'normal',
                        letterSpacing: '-0.16px'
                      }}
                    >
                      {cveData.description}
                    </p>
                  </div>

                  <div>
                    <div className='mb-2 flex items-center'>
                      <h4
                        className='mb-0'
                        style={{
                          alignSelf: 'stretch',
                          color: '#1c2024',
                          fontFamily: 'HarmonyOS Sans SC',
                          fontSize: '24px',
                          fontStyle: 'normal',
                          fontWeight: 500,
                          lineHeight: 'normal',
                          letterSpacing: '-0.16px'
                        }}
                      >
                        Product Status
                      </h4>
                      <button
                        className='ml-2 hover:bg-blue-200'
                        style={{
                          display: 'flex',
                          height: '24px',
                          padding: '0 8px',
                          justifyContent: 'center',
                          alignItems: 'center',
                          gap: '4px',
                          borderRadius: '3px',
                          border: '1px solid #0034dc73',
                          background: 'transparent',
                          color: '#002bb7c4',
                          fontFamily: 'SF Pro',
                          fontSize: '12px',
                          fontStyle: 'normal',
                          fontWeight: 500,
                          lineHeight: '16px',
                          letterSpacing: '0.04px'
                        }}
                      >
                        Learn More
                      </button>
                    </div>
                    <div className='flex items-center justify-between'>
                      <div className='space-y-2'>
                        <p className='text-sm text-gray-600'>
                          <span className='font-medium'>Patched:</span> {cveData.patched || 'No information available'}
                        </p>
                        {cveData.unaffected && (
                          <p className='text-sm text-gray-600'>
                            <span className='font-medium'>Unaffected:</span> {cveData.unaffected}
                          </p>
                        )}
                      </div>
                    </div>
                  </div>

                  <div>
                    <div className='mb-2 flex items-center'>
                      <h4
                        style={{
                          alignSelf: 'stretch',
                          color: '#1c2024',
                          fontFamily: 'HarmonyOS Sans SC',
                          fontSize: '24px',
                          fontStyle: 'normal',
                          fontWeight: 500,
                          lineHeight: 'normal',
                          letterSpacing: '-0.16px'
                        }}
                      >
                        References
                      </h4>
                      <span
                        className='ml-2'
                        style={{
                          display: 'flex',
                          padding: '2px 6px',
                          justifyContent: 'center',
                          alignItems: 'center',
                          gap: '6px',
                          borderRadius: '3px',
                          background: '#0047f112',
                          color: '#002bb7c4',
                          fontFamily: 'HarmonyOS Sans SC',
                          fontSize: '12px',
                          fontStyle: 'normal',
                          fontWeight: 400,
                          lineHeight: '16px',
                          letterSpacing: '0.04px',
                          marginTop: '4px'
                        }}
                      >
                        {references.length} Total
                      </span>
                    </div>
                    <div className='space-y-2'>
                      {references.map((ref) => (
                        <a
                          key={ref.url}
                          href={ref.url}
                          target='_blank'
                          rel='noopener noreferrer'
                          style={{
                            alignSelf: 'stretch',
                            color: '#002bb7c4',
                            fontFamily: 'HarmonyOS Sans SC',
                            fontSize: '16px',
                            fontStyle: 'normal',
                            fontWeight: 300,
                            lineHeight: 'normal',
                            letterSpacing: '-0.1px'
                          }}
                          className='block hover:text-blue-800'
                        >
                          {ref.url}
                        </a>
                      ))}
                    </div>
                  </div>

                  <div
                    style={{
                      alignSelf: 'stretch',
                      color: '#1c2024',
                      fontFamily: 'HarmonyOS Sans SC',
                      fontSize: '16px',
                      fontStyle: 'normal',
                      fontWeight: 500,
                      lineHeight: 'normal',
                      letterSpacing: '-0.16px'
                    }}
                  >
                    <p>
                      <span style={{ fontWeight: 500, color: '#1c2024', fontSize: '16px' }}>Reported: </span>
                      <span style={{ fontWeight: 400, color: '#80838d', fontSize: '16px' }}>{cveData.reported}</span>
                    </p>
                    <p>
                      <span style={{ fontWeight: 500, color: '#1c2024', fontSize: '16px' }}>Issued: </span>
                      <span style={{ fontWeight: 400, color: '#80838d', fontSize: '16px' }}>{cveData.issued}</span>
                    </p>
                  </div>
                </div>
              </div>

              {/* CVE Program 卡片 */}
              <div className='rounded-lg border border-gray-200 bg-white p-6 shadow-sm'>
                <h3
                  className='mb-4'
                  style={{
                    alignSelf: 'stretch',
                    color: '#3a5bc7',
                    fontFamily: 'HarmonyOS Sans SC',
                    fontSize: '32px',
                    fontStyle: 'normal',
                    fontWeight: 500,
                    lineHeight: '40px',
                    letterSpacing: '-0.16px'
                  }}
                >
                  CVE : Program
                </h3>
                <div
                  style={{
                    width: '100%',
                    height: '1px',
                    background: 'rgba(0, 0, 0, 0.08)',
                    marginBottom: '16px'
                  }}
                />

                <div className='space-y-4'>
                  <div>
                    <div className='mb-2 flex items-center'>
                      <h4
                        style={{
                          alignSelf: 'stretch',
                          color: '#1c2024',
                          fontFamily: 'HarmonyOS Sans SC',
                          fontSize: '24px',
                          fontStyle: 'normal',
                          fontWeight: 500,
                          lineHeight: 'normal',
                          letterSpacing: '-0.16px'
                        }}
                      >
                        References
                      </h4>
                      <span
                        className='ml-2'
                        style={{
                          display: 'flex',
                          padding: '2px 6px',
                          justifyContent: 'center',
                          alignItems: 'center',
                          gap: '6px',
                          borderRadius: '3px',
                          background: '#0047f112',
                          color: '#002bb7c4',
                          fontFamily: 'HarmonyOS Sans SC',
                          fontSize: '12px',
                          fontStyle: 'normal',
                          fontWeight: 400,
                          lineHeight: '16px',
                          letterSpacing: '0.04px',
                          marginTop: '4px'
                        }}
                      >
                        {references.length} Total
                      </span>
                    </div>
                    <div className='space-y-2'>
                      {references.map((ref) => (
                        <a
                          key={ref.url}
                          href={ref.url}
                          target='_blank'
                          rel='noopener noreferrer'
                          style={{
                            alignSelf: 'stretch',
                            color: '#002bb7c4',
                            fontFamily: 'HarmonyOS Sans SC',
                            fontSize: '16px',
                            fontStyle: 'normal',
                            fontWeight: 300,
                            lineHeight: 'normal',
                            letterSpacing: '-0.1px'
                          }}
                          className='block hover:text-blue-800'
                        >
                          {ref.url}
                        </a>
                      ))}
                    </div>
                  </div>

                  <div
                    style={{
                      alignSelf: 'stretch',
                      color: '#1c2024',
                      fontFamily: 'HarmonyOS Sans SC',
                      fontSize: '16px',
                      fontStyle: 'normal',
                      fontWeight: 500,
                      lineHeight: 'normal',
                      letterSpacing: '-0.16px'
                    }}
                  >
                    <p>
                      <span style={{ fontWeight: 500, color: '#1c2024', fontSize: '16px' }}>Issued: </span>
                      <span style={{ fontWeight: 400, color: '#80838d', fontSize: '16px' }}>{cveData.issued}</span>
                    </p>
                  </div>

                  <p
                    style={{
                      alignSelf: 'stretch',
                      color: '#80838d',
                      fontFamily: 'HarmonyOS Sans SC',
                      fontSize: '16px',
                      fontStyle: 'normal',
                      fontWeight: 400,
                      lineHeight: 'normal',
                      letterSpacing: '-0.16px',
                      marginTop: '4px'
                    }}
                  >
                    This container includes required additional information provided by the CVE Program for this
                    vulnerability.
                  </p>
                </div>
              </div>
            </div>
          )}

          {/* 图谱内容 */}
          {activeTab === 'graph' && (
            <div className='rounded-lg border border-gray-200 bg-white p-4'>
              {graphLoading && <div className='p-8 text-center text-gray-500'>图谱数据加载中...</div>}
              {!graphLoading && graphError && <div className='mb-2 p-2 text-center text-red-500'>{graphError}</div>}
              {!graphLoading && graphData && (
                <div className='px-2 py-2'>
                  <CveGraph rootId={cveData?.id || 'CVE'} data={graphData} />
                </div>
              )}
              {!graphLoading && !graphData && !graphError && <div className='text-gray-400'>暂无数据</div>}
            </div>
          )}

          {/* 建议信息占位 */}
          {activeTab === 'advisories' && (
            <div className='space-y-6'>
              <div className='rounded-lg border border-gray-200 bg-white p-6 shadow-sm'>
                <h3
                  className='mb-4'
                  style={{
                    alignSelf: 'stretch',
                    color: '#3a5bc7',
                    fontFamily: 'HarmonyOS Sans SC',
                    fontSize: '32px',
                    fontStyle: 'normal',
                    fontWeight: 500,
                    lineHeight: '40px',
                    letterSpacing: '-0.16px'
                  }}
                >
                  CVE Advisories
                </h3>
                <div
                  style={{
                    width: '100%',
                    height: '1px',
                    background: 'rgba(0, 0, 0, 0.08)',
                    marginBottom: '16px'
                  }}
                />
                <div className='space-y-4'>
                  <div className='flex items-center'>
                    <h4
                      style={{
                        alignSelf: 'stretch',
                        color: '#1c2024',
                        fontFamily: 'HarmonyOS Sans SC',
                        fontSize: '24px',
                        fontStyle: 'normal',
                        fontWeight: 500,
                        lineHeight: 'normal',
                        letterSpacing: '-0.16px'
                      }}
                    >
                      Recommended Actions
                    </h4>
                    <span
                      className='ml-2'
                      style={{
                        display: 'flex',
                        padding: '2px 6px',
                        justifyContent: 'center',
                        alignItems: 'center',
                        gap: '6px',
                        borderRadius: '3px',
                        background: '#0047f112',
                        color: '#002bb7c4',
                        fontFamily: 'HarmonyOS Sans SC',
                        fontSize: '12px',
                        fontStyle: 'normal',
                        fontWeight: 400,
                        lineHeight: '16px',
                        letterSpacing: '0.04px',
                        marginTop: '4px'
                      }}
                    >
                      {advisories?.length ?? 0} Total
                    </span>
                  </div>

                  {advisoriesLoading && (
                    <div className='rounded-md border border-blue-100 bg-blue-50 p-4 text-sm text-blue-700'>建议数据加载中...</div>
                  )}

                  {!advisoriesLoading && advisoriesError && (
                    <div className='rounded-md border border-red-100 bg-red-50 p-4 text-sm text-red-600'>{advisoriesError}</div>
                  )}

                  {!advisoriesLoading && !advisoriesError && advisories && advisories.length > 0 && (
                    <div className='space-y-4'>
                      {advisories.map((advisory) => {
                        const advisoryKey = `${advisory.crate_version}-${advisory.dep}-${advisory.trigger}-${advisory.reason}`
                        
                        return (
                          <div key={advisoryKey} className='rounded-lg border border-gray-100 bg-gray-50 p-4'>
                          <div className='mb-2 flex items-center justify-between'>
                            <p
                              style={{
                                color: '#1c2024',
                                fontFamily: 'HarmonyOS Sans SC',
                                fontSize: '18px',
                                fontWeight: 500,
                                letterSpacing: '-0.1px'
                              }}
                            >
                              {advisory.crate_version}
                            </p>
                            <span
                              style={{
                                display: 'inline-flex',
                                padding: '0 8px',
                                height: '24px',
                                alignItems: 'center',
                                borderRadius: '3px',
                                border: '1px solid #0034dc73',
                                color: '#002bb7c4',
                                fontFamily: 'SF Pro',
                                fontSize: '12px',
                                fontWeight: 500
                              }}
                            >
                              {advisory.dep}
                            </span>
                          </div>
                          <div className='space-y-1 text-sm text-gray-600'>
                            <p>
                              <span style={{ fontWeight: 500, color: '#1c2024', fontSize: '16px' }}>Trigger: </span>
                              {advisory.trigger || 'N/A'}
                            </p>
                            <p>
                              <span style={{ fontWeight: 500, color: '#1c2024', fontSize: '16px' }}>Reason: </span>
                              {advisory.reason || 'N/A'}
                            </p>
                          </div>
                          </div>
                        )
                      })}
                    </div>
                  )}

                  {!advisoriesLoading && !advisoriesError && (!advisories || advisories.length === 0) && (
                    <p
                      style={{
                        alignSelf: 'stretch',
                        color: '#80838d',
                        fontFamily: 'HarmonyOS Sans SC',
                        fontSize: '16px',
                        fontStyle: 'normal',
                        fontWeight: 400,
                        lineHeight: 'normal',
                        letterSpacing: '-0.16px'
                      }}
                    >
                      暂无相关建议数据。
                    </p>
                  )}
                </div>
              </div>
            </div>
          )}
        </div>
      </div>
    </>
  )
}

CVEInfoPage.getProviders = (page: any, pageProps: any) => {
  return (
    <AuthAppProviders {...pageProps}>
      <AppLayout {...pageProps}>{page}</AppLayout>
    </AuthAppProviders>
  )
}
