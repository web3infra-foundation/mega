# ============================================================================
# Mega / Orion Demo Environment Configuration File Example
# ============================================================================
#
# Usage:
# 1. Copy this file to .env: cp .env.example .env
# 2. Modify values in .env as needed (do not commit .env to version control)
# 3. Start services with: docker compose -f docker-compose.demo.yml up -d
#
# IMPORTANT: This configuration is for local Demo / demonstration purposes only,
# NOT suitable for production environments!
# ============================================================================

# ----------------------------------------------------------------------------
# PostgreSQL Database Configuration
# ----------------------------------------------------------------------------

POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_DB_MONO=mono
# Note: Orion Server uses the SAME mono database (no separate orion db required)
# Note: campsite database is now managed by MySQL service

# ----------------------------------------------------------------------------
# MySQL Database Configuration (for Campsite API)
# ----------------------------------------------------------------------------
# Note: For demo purposes, using root user only. For production, create dedicated user.

MYSQL_ROOT_PASSWORD=mysqladmin
MYSQL_DATABASE=campsite_api_demo

# ----------------------------------------------------------------------------
# RustFS (S3-compatible Object Storage) Configuration
# ----------------------------------------------------------------------------

RUSTFS_ACCESS_KEY=rustfsadmin
RUSTFS_SECRET_KEY=rustfsadmin
RUSTFS_CONSOLE_ENABLE=true

# ----------------------------------------------------------------------------
# S3 Storage Configuration (used by Mega and optionally Orion S3 log store)
# ----------------------------------------------------------------------------

S3_ACCESS_KEY_ID=rustfsadmin
S3_SECRET_ACCESS_KEY=rustfsadmin
S3_REGION=us-east-1

# ----------------------------------------------------------------------------
# Docker Image Configuration
# ----------------------------------------------------------------------------
# All images are pulled from Amazon ECR Public: public.ecr.aws/m8q5m4u3/mega
# You can override these to use local images or different tags

MEGA_ENGINE_IMAGE=public.ecr.aws/m8q5m4u3/mega:mono-0.1.0-pre-release
MEGA_UI_IMAGE=public.ecr.aws/m8q5m4u3/mega:mega-ui-demo-0.1.0-pre-release
ORION_SERVER_IMAGE=public.ecr.aws/m8q5m4u3/mega:orion-server-0.1.0-pre-release
MEGA_DEV_IMAGE=public.ecr.aws/m8q5m4u3/mega:orion-client-0.1.0-pre-release
CAMPSITE_API_IMAGE=public.ecr.aws/m8q5m4u3/mega:campsite-0.1.0-pre-release

# ----------------------------------------------------------------------------
# Mega Backend Service Configuration
# ----------------------------------------------------------------------------

MEGA_DATABASE__DB_TYPE=postgres
MEGA_DATABASE__DB_URL=postgres://postgres:postgres@postgres:5432/mono
MEGA_REDIS__URL=redis://redis:6379

MEGA_MONOREPO__STORAGE_TYPE=s3compatible
# Add your GitHub login name here to grant admin access (comma-separated for multiple users)
MEGA_MONOREPO__ADMIN="benjamin_747,genedna"
MEGA_OBJECT_STORAGE__S3__ENDPOINT_URL=http://rustfs:9000
MEGA_OBJECT_STORAGE__S3__BUCKET=mega
MEGA_OBJECT_STORAGE__S3__REGION=us-east-1

MEGA_LOG__LEVEL=info
MEGA_LOG__PRINT_STD=true

MEGA_AUTHENTICATION__ENABLE_TEST_USER=true
MEGA_AUTHENTICATION__TEST_USER_NAME=mega
MEGA_AUTHENTICATION__TEST_USER_TOKEN=mega

MEGA_BUILD__ENABLE_BUILD=true
MEGA_BUILD__ORION_SERVER=http://orion_server:8004

MEGA_OAUTH__CAMPSITE_API_DOMAIN=http://api.gitmono.local:8080
MEGA_OAUTH__UI_DOMAIN=http://app.gitmono.local
MEGA_OAUTH__COOKIE_DOMAIN=gitmono.local
MEGA_OAUTH__ALLOWED_CORS_ORIGINS="http://app.gitmono.local"

MEGA_BASE_DIR=/opt/mega
MEGA_CACHE_DIR=/opt/mega/cache


# ----------------------------------------------------------------------------
# Orion Server Configuration
# ----------------------------------------------------------------------------
# IMPORTANT: Orion Server uses mono database

ORION_DATABASE_URL=postgres://postgres:postgres@postgres:5432/mono
ORION_BUILD_LOG_DIR=/tmp/buck2ctl
ORION_ALLOWED_CORS_ORIGINS=http://app.gitmono.local
ORION_LOGGER_STORAGE_TYPE=local
ORION_BUCKET_NAME=orion-logs

# ----------------------------------------------------------------------------
# Orion Build Client / Worker Configuration
# ----------------------------------------------------------------------------

ORION_WORKER_SERVER_WS=ws://orion_server:8004/ws
ORION_WORKER_ID=
BUCK_PROJECT_ROOT=/workspace
BUILD_TMP=/tmp/orion-builds
SCORPIO_API_BASE_URL=http://127.0.0.1:2725
ORION_WORKER_START_SCORPIO=true
SCORPIO_BASE_URL=http://mega:8000
SCORPIO_LFS_URL=http://mega:8000
RUST_LOG=info

# ----------------------------------------------------------------------------
# Campsite API Configuration
# ----------------------------------------------------------------------------

CAMPSITE_REDIS_URL=redis://redis:6379
CAMPSITE_RAILS_ENV=demo
CAMPSITE_SERVER_COMMAND=bundle exec puma
CAMPSITE_DEV_APP_URL=http://app.gitmono.local
CAMPSITE_RAILS_MASTER_KEY=51d8cdb046869075795ba82cdd95807a

# Run migrations only on first startup; set to 0 afterwards for faster launches.
# 1 = run migrations (default first run) | 0 = skip migrations
CAMPSITE_RUN_MIGRATIONS=1